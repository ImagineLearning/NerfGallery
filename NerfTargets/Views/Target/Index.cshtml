<div id="text" style="font-size: 300px; text-align: center"></div>
<div id="debug"></div>
<button id="testButton" onclick="tabletHit()">Test Hit</button>


@section scripts {
	<!--Script references. -->
	<!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
	<!--Reference the SignalR library. -->
	<script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
	<!--Reference the autogenerated SignalR hub script. -->
	<script src="~/signalr/hubs"></script>
	<!--SignalR script to update the chat page and send messages.-->
	<script>
		var hub;
		var canSendHit = true;
		var clientId;

		function getParameterByName(name) {
			name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
			var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
				results = regex.exec(location.search);
			return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
		}

		function debug(text) {
			$('#debug').text($('#debug').text() + text);
		}

		$(function () {
			clientId = getParameterByName('t');
			debug('client id: ' + clientId);
			// Reference the auto-generated proxy for the hub.
			hub = $.connection.targetHub;
			// Create a function that the hub can call back to display messages.
			hub.client.showText = function(text) {
				// Add the message to the page.
				$('#text').text(text);
			};

			hub.client.showTarget = function() {
				$('#text').text('Hit Me');
			}

			hub.client.hideTarget = function() {
				$('#text').text('');
			}

			$.connection.hub.start().done(function() {
				hub.server.setClientId(clientId);
			});

			window.tabletHit = function() {
				if (typeof hub !== 'undefined' && canSendHit) {
					var goodHit = $('#text').text() == 'Hit Me';
					hub.server.recordHit(goodHit);
					canSendHit = false;
					setTimeout(function () { canSendHit = true; }, 5000);
					debug( 'sent hit ' + (goodHit ? '[good]' : '[bad]'));
				}
			}

			

			if (window.DeviceMotionEvent != undefined) {
				window.ondevicemotion = function (e) {

					if (e.rotationRate) {
						var alpha = e.rotationRate.alpha;
						var beta = e.rotationRate.beta;
						var gamma = e.rotationRate.gamma;

						if (Math.abs(alpha) > 1 || Math.abs(beta) > 1 || Math.abs(gamma) > 1) {
							tabletHit();

						}
					}
				}
			}
		});

		
	</script>
}